# 智阅AI 概要设计

## 文档信息

- **文档名称**: 智阅AI 概要设计
- **版本**: V1.0
- **创建日期**: 2026-01-27
- **相关文档**: 
  - [产品需求说明书](智阅AI（SmartRead%20AI）产品需求说明书.md)
  - [MVP 迭代路线图](MVP_ROADMAP.md)
  - [OpenSpec 变更提案](../openspec/changes/add-smartread-mvp-plan/)

## 一、设计目标

### 1.1 核心目标

基于产品需求说明书，采用 **最小 MVP 方式**进行有节奏的迭代开发，实现：

1. **快速验证产品价值** - 优先实现核心功能，快速验证用户需求
2. **降低开发风险** - 分阶段攻克技术难点，避免功能堆积
3. **保持开发节奏** - 明确的里程碑和交付物，每 2-3 周交付一个可用版本
4. **技术架构可扩展** - 为后续功能扩展预留接口

### 1.2 设计原则

- **独立交付** - 每个迭代都能独立交付可用功能
- **向后兼容** - 后续迭代不破坏前期功能
- **用户价值优先** - 优先实现对用户价值最大的功能
- **技术债务可控** - 在快速迭代和代码质量间保持平衡

## 二、迭代规划

### 2.1 三阶段 MVP 迭代

```
MVP-1 (Week 1-3)          MVP-2 (Week 4-6)          MVP-3 (Week 7-9)
核心阅读辅助      →      云端增强与知识沉淀    →    高级功能与商业化
     ↓                         ↓                         ↓
验证核心价值              扩展AI能力                完善差异化功能
建立基础架构              引入知识管理              准备商业化上线
```

### 2.2 功能分层

```
┌─────────────────────────────────────────────────────────┐
│                    MVP-3: 商业化层                       │
│  多模型切换 | 多文档对比 | 知识图谱 | 付费功能          │
├─────────────────────────────────────────────────────────┤
│                    MVP-2: 增强层                         │
│  云端AI | 代码解析 | 公式解析 | 知识收藏 | Token管理    │
├─────────────────────────────────────────────────────────┤
│                    MVP-1: 基础层                         │
│  划词交互 | 本地AI | 简化/解释 | 注入式UI | 基础设置   │
└─────────────────────────────────────────────────────────┘
```

## 三、系统架构

### 3.1 整体架构图

```
┌──────────────────────────────────────────────────────────┐
│                      User Interface                       │
│  ┌────────────┐  ┌────────────┐  ┌────────────┐         │
│  │ Content UI │  │   Popup    │  │  Options   │         │
│  │ (划词工具栏)│  │ (知识检索) │  │  (设置)    │         │
│  └─────┬──────┘  └─────┬──────┘  └─────┬──────┘         │
└────────┼────────────────┼────────────────┼───────────────┘
         │                │                │
         └────────────────┼────────────────┘
                          │
                 ┌────────▼────────┐
                 │   Background    │
                 │ Service Worker  │
                 │  (核心调度层)    │
                 └────────┬────────┘
                          │
         ┌────────────────┼────────────────┐
         │                │                │
    ┌────▼────┐    ┌─────▼─────┐    ┌────▼────┐
    │ AI 引擎 │    │ 知识管理   │    │ 存储层  │
    └────┬────┘    └─────┬─────┘    └────┬────┘
         │                │                │
    ┌────┼────┐      ┌───┼───┐      ┌────┼────┐
    │    │    │      │   │   │      │    │    │
  本地  云端  │    图谱 检索 │    Chrome IndexedDB
   AI   AI   │    构建 引擎 │    Storage
         降级                      加密
```

### 3.2 模块职责

#### 3.2.1 Content Script 层
- **职责**: 用户交互、UI 注入
- **核心组件**:
  - `SelectionDetector` - 文本选择监听
  - `Toolbar` - 划词工具栏（Shadow DOM）
  - `ResultBox` - 结果展示框（Shadow DOM）
  - `MessageBridge` - 与 Background 通信

#### 3.2.2 Background Service Worker 层
- **职责**: 核心业务逻辑、AI 调度、数据管理
- **核心组件**:
  - `AIEngine` - AI 引擎调度器
  - `LocalAIProvider` - 本地 AI 提供者
  - `CloudAIProvider` - 云端 AI 提供者
  - `KnowledgeManager` - 知识管理器
  - `StorageManager` - 存储管理器
  - `MessageRouter` - 消息路由器

#### 3.2.3 Popup 层
- **职责**: 快速访问、知识检索
- **核心组件**:
  - `SearchPanel` - 知识检索面板
  - `TokenUsage` - Token 使用统计
  - `QuickSettings` - 快速设置

#### 3.2.4 Options 层
- **职责**: 高级设置、数据管理
- **核心组件**:
  - `APIKeyManager` - API 密钥管理
  - `ModelSelector` - 模型选择器
  - `BudgetManager` - 预算管理
  - `DataExporter` - 数据导出

### 3.3 数据流

#### 3.3.1 本地 AI 处理流程

```
用户划词选择文本
       ↓
Content Script 捕获选择
       ↓
发送消息到 Background
       ↓
Background 检测本地 AI 可用性
       ↓
调用 Gemini Nano / 降级规